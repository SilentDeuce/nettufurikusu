<center><h3><a href="javascript:(function()%7Bvar%20clq%3Ddocument.location.href.split(%22%3A%22)%5B3%5D%2CknpJsonLink%3D%22https%3A%2F%2Foriginator.backlot.netflix.com%2Fapi%2Fknp%2Fclq%3Aorigination%3A%22%2Bclq%2CtaskTitle%3Ddocument.getElementsByClassName(%22cpe-page-menu-label%22)%5B0%5D.innerText%3BtaskTitle%3DtaskTitle.split(%22%2C%22)%3Bvar%20LANG%3DtaskTitle%5BtaskTitle.length-2%5D.trim()%3B%22zh-Hans%22%3D%3DLANG%26%26(LANG%3D%22zh-CN%22)%2C%22en%22%3D%3DLANG%26%26(LANG%3Dprompt(%22English%20is%20always%20included.%20Enter%20a%20different%20language%20code%3A%20ar%2C%20de%2C%20fr%2C%20ru%2C%20but%20pt-BR%20and%20zh-CN%22))%3Bvar%20getJSON%3Dasync%20a%3D%3E%7Btry%7Bconst%20b%3Dawait%20fetch(a)%3Bif(!b.ok)throw%20new%20Error(b.statusText)%3Bconst%20c%3Dawait%20b.json()%3Breturn%20c%7Dcatch(a)%7Breturn%20a%7D%7D%3Bfunction%20nameCsv(a%3D%22%22)%7Bvar%20b%3Ddocument.getElementsByClassName(%22cpe-page-menu-label%22)%5B0%5D.innerText%2Cc%3D%22KNP_%22%2B(b.replace(%2F%5B%20%5D%2Fg%2C%22_%22).replace(%2F%5B%5Ea-z0-9_%5D%2Fgi%2C%22%22)%2Ba%2B%22.csv%22).trim()%3Breturn%20c%7C%7C(c%3Dclq%2B%22_%22%2Ba%2B%22.csv%22)%2Cc%7Dvar%20csvName%3DnameCsv(%22_%22%2BLANG)%3Bfunction%20denull(a)%7Breturn%20a%3Fa.trim()%3A%22%22%7Dvar%20majorEntities%3D%5B%22PERSON%22%2C%22LOCATION%22%2C%22ORGANIZATION%22%2C%22PHRASE%22%5D%3Bfunction%20arrayToCsv(a)%7Breturn%20a.map(a%3D%3Ea.map(String).map(a%3D%3Ea.replaceAll(%22%5C%22%22%2C%22%5C%22%5C%22%22)).map(a%3D%3E%60%22%24%7Ba%7D%22%60).join(%22%2C%22)).join(%22%5Cr%5Cn%22)%7Dvar%20oKnp%3D%7B%7D%2CfinalArray%3D%5B%5D%2Cheader_2%3D%5B%22TYPE%22%2C%22TEMPLATE%20(EN)%22%2C%22NOTE%22%2C%22TARGET%20(%22%2BLANG%2B%22)%22%2C%22NOTE%20(%22%2BLANG%2B%22)%22%5D%2CtmpArray%3D%5B%5D%3BgetJSON(knpJsonLink).then(b%3D%3E%7Bif(oKnp%3Db%2C%22en%22%3D%3DoKnp.srcLocale)%7BfinalArray.push(header_2)%3Bfor(const%20a%20of%20majorEntities)%22undefined%22!%3Dtypeof%20oKnp.mapKnpTermDTOs%5Ba%5D%26%26oKnp.mapKnpTermDTOs%5Ba%5D.forEach(a%3D%3E%7Btry%7BtmpArray.push(a.type%2Cdenull(a.srcValue.value)%2Cdenull(a.srcValue.note)%2Cdenull(a.localizedValues%5BLANG%5D.value)%2Cdenull(a.localizedValues%5BLANG%5D.note))%2CfinalArray.push(tmpArray)%2CtmpArray%3D%5B%5D%7Dcatch(a)%7B%7D%7D)%3BoKnp.titleDTOs.forEach(a%3D%3E%7Btry%7BtmpArray.push(a.type%2Ca.srcValue.value%2Ca.srcValue.note%2Ca.localizedValues%5BLANG%5D.value%2Ca.localizedValues%5BLANG%5D.note)%2CfinalArray.push(tmpArray)%2CtmpArray%3D%5B%5D%7Dcatch(a)%7B%7D%7D)%7Delse%7Bvar%20c%3DoKnp.srcLocale%2Cd%3D%5B%22TYPE%22%2C%22SOURCE%20(%22%2Bc%2B%22)%22%2C%22TEMPLATE%20(EN)%22%2C%22NOTE%20(EN)%22%2C%22TARGET%20(%22%2BLANG%2B%22)%22%2C%22NOTE%20(%22%2BLANG%2B%22)%22%5D%3BfinalArray.push(d)%3Bfor(const%20a%20of%20majorEntities)%22undefined%22!%3Dtypeof%20oKnp.mapKnpTermDTOs%5Ba%5D%26%26oKnp.mapKnpTermDTOs%5Ba%5D.forEach(a%3D%3E%7Btry%7BtmpArray.push(a.type%2Cdenull(a.srcValue.value)%2Cdenull(a.localizedValues.en.value)%2Cdenull(a.localizedValues.en.note)%2Cdenull(a.localizedValues%5BLANG%5D.value)%2Cdenull(a.localizedValues%5BLANG%5D.note))%2CfinalArray.push(tmpArray)%2CtmpArray%3D%5B%5D%7Dcatch(a)%7B%7D%7D)%3Bfor(g%3D0%3Bg%3CoKnp.titleDTOs.length-1%3Bg%2B%2B)try%7BtmpArray.push(oKnp.titleDTOs%5Bg%5D.type%2Cdenull(oKnp.titleDTOs%5Bg%5D.srcValue.value)%2Cdenull(oKnp.titleDTOs%5Bg%5D.localizedValues.en.value)%2Cdenull(oKnp.titleDTOs%5Bg%5D.localizedValues.en.note)%2Cdenull(oKnp.titleDTOs%5Bg%5D.localizedValues%5BLANG%5D.value)%2Cdenull(oKnp.titleDTOs%5Bg%5D.localizedValues%5BLANG%5D.note))%2CfinalArray.push(tmpArray)%2CtmpArray%3D%5B%5D%7Dcatch(a)%7B%7D%7Dlet%20e%3DarrayToCsv(finalArray)%3Bvar%20f%3Dwindow.document.createElement(%22a%22)%3Bf.setAttribute(%22href%22%2C%22data%3Atext%2Fcsv%3B%20charset%3Dutf-8%2C%22%2BencodeURIComponent(%22%5CuFEFF%22%2Be))%2Cf.setAttribute(%22download%22%2CcsvName)%2Cwindow.document.body.appendChild(f)%2Cf.click()%7D).catch(a%3D%3E%7Bconsole.error(a)%7D)%3B%7D)()%3B">Knp2Csv</a>
  
  
<br><hr>  Source:
  </center><br><hr>
  <pre>  
  	var clq = document.location.href.split(":")[3]
	var knpJsonLink = "https://originator.backlot.netflix.com/api/knp/clq:origination:" + clq
	var taskTitle = document.getElementsByClassName("cpe-page-menu-label")[0].innerText
	taskTitle = taskTitle.split(",")
	var LANG = taskTitle[taskTitle.length - 2].trim()
	if (LANG == "zh-Hans") {
	    LANG = "zh-CN"
	} //special case
	if (LANG == "en") {
	    LANG = prompt("English is always included. Enter a different language code: ar, de, fr, ru, but pt-BR and zh-CN");
	}


	var getJSON = async url => {
	    try {
	        const response = await fetch(url);
	        if (!response.ok)
	            throw new Error(response.statusText);
	        const data = await response.json();
	        return data;
	    } catch (error) {
	        return error;
	    }
	}

	function nameCsv(suffix = "") {
	    var s = document.getElementsByClassName("cpe-page-menu-label")[0]
	        .innerText
	    var srtName = "KNP_" + (s.replace(/[ ]/g, '_').replace(/[^a-z0-9_]/gi, '') +
	            suffix + ".csv"
	        )
	        .trim()
	    if (!srtName) srtName = clq + "_" + suffix +
	        ".csv"
	    return srtName
	}
	var csvName = nameCsv("_" + LANG)

	function denull(value) {
	    if (!value) {
	        return ""
	    } else {
	        return value.trim()
	    }
	}

	var majorEntities = ["PERSON", "LOCATION", "ORGANIZATION", "PHRASE"]

	function arrayToCsv(data) {
	    return data.map(row => row
	        .map(String)
	        .map(v => v.replaceAll('"', '""'))
	        .map(v => `"${v}"`)
	        .join(',')
	    ).join('\r\n');
	}

	var oKnp = {}
	var finalArray = []
	var header_2 = ["TYPE", "TEMPLATE (EN)", "NOTE", "TARGET (" + LANG + ")", "NOTE (" + LANG + ")"]
	var tmpArray = []
	getJSON(knpJsonLink).then(data => {

	    oKnp = data
	    if (oKnp.srcLocale == "en") {
	        finalArray.push(header_2)
	        for (const Entity of majorEntities) {
	            if (typeof oKnp.mapKnpTermDTOs[Entity] !== "undefined") {
	                oKnp.mapKnpTermDTOs[Entity].forEach((v) => {
	                    try {
	                        tmpArray.push(v.type, denull(v.srcValue.value), denull(v.srcValue.note), denull(v.localizedValues[LANG].value), denull(v.localizedValues[LANG].note))
	                        finalArray.push(tmpArray);
	                        tmpArray = [];
	                    } catch (e) {}
	                })
	            }
	        }

	        oKnp.titleDTOs.forEach((t) => {
	            try {
	                tmpArray.push(t.type, t.srcValue.value, t.srcValue.note, t.localizedValues[LANG].value, t.localizedValues[LANG].note)
	                finalArray.push(tmpArray);
	                tmpArray = [];
	            } catch (e) {}
	        })

	    } else {
	        var LANG_SRC = oKnp.srcLocale
	        var header_3 = ["TYPE", "SOURCE (" + LANG_SRC + ")", "TEMPLATE (EN)", "NOTE (EN)", "TARGET (" + LANG + ")", "NOTE (" + LANG + ")"]
	        finalArray.push(header_3)
	        for (const Entity of majorEntities) {

	            if (typeof oKnp.mapKnpTermDTOs[Entity] !== "undefined") {
	                oKnp.mapKnpTermDTOs[Entity].forEach((v) => {
	                    try {
	                        tmpArray.push(v.type, denull(v.srcValue.value), denull(v.localizedValues["en"].value), denull(v.localizedValues["en"].note), denull(v.localizedValues[LANG].value), denull(v.localizedValues[LANG].note))
	                        finalArray.push(tmpArray);
	                        tmpArray = [];
	                    } catch (e) {}
	                })
	            }
	        }

	        for (g = 0; g < oKnp.titleDTOs.length - 1; g++) {
	            try {
	                tmpArray.push(oKnp.titleDTOs[g].type, denull(oKnp.titleDTOs[g].srcValue.value), denull(oKnp.titleDTOs[g].localizedValues["en"].value), denull(oKnp.titleDTOs[g].localizedValues["en"].note), denull(oKnp.titleDTOs[g].localizedValues[LANG].value), denull(oKnp.titleDTOs[g].localizedValues[LANG].note))
	                finalArray.push(tmpArray);
	                tmpArray = [];
	            } catch (e) {}
	        }



	    }
	    let csv = arrayToCsv(finalArray)
	    var universalBOM = "\uFEFF";
	    var a = window.document.createElement('a');
	    a.setAttribute('href', 'data:text/csv; charset=utf-8,' + encodeURIComponent(universalBOM + csv));
	    a.setAttribute('download', csvName);
	    window.document.body.appendChild(a);
	    a.click();
	}).catch(error => {
	    console.error(error);
	});
